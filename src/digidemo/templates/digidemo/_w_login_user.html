{% load staticfiles %}
{% load apptags %}

{% if request|getLoggedInUser != "false" %}

	<!-- if user logged in, show greeting, profile link, and logout button -->
	<div id="login_div">
		<div class="login_elm">
			Welcome,&nbsp;
		</div>
		<div class="login_elm">
			<a href="{% url "userProfile" request|getLoggedInUser %}">
				{{request|getLoggedInUser}}
			</a>
		</div>
		<div class="login_elm_right">
			&nbsp;<input type="button" id="logout" value="logout" />
		</div>
	</div>
	<!-- end of greeting, profile link, and logout button -->

{% else %}

	<!-- otherwise, show login form and register link -->
	<div id="login_div">
		<div class="login_elm">
			<a href="{% url "userRegistration" %}">register</a>
		</div>
		<div class="login_elm">
			|
		</div>
		<div class="login_elm" id="login">
			<a id="login-trigger" >
				login
			</a>
			<div id="login-content">
				<form id="login_form">
					<fieldset id="inputs">
						<input id="username" type="text"
							name="username" placeholder="username"
							required />
						<input id="password" type="password"
							name="password" placeholder="password"
							required />
					</fieldset>

					<fieldset id="actions">
						<input type="button" id="submit_login" value="Log in" />
						<label>
							<input type="checkbox" checked="checked" />
							Keep me signed in
						</label>
						<label>
						    <a href="{% url "resetPassword" %}">Reset password</a>
						   </label>
					</fieldset>
				</form>
			</div>
		</div>
	</div>
	<!-- end of login form and register link -->

{% endif %}
<script>
(function(){

	RELOAD_URL = '{% url "do_reload" %}';

	// arm the login triger to slide open / closed the login form
	$('#login-trigger').click(function(){
		$(this).next('#login-content').slideToggle();
		$(this).toggleClass('active');
		
		if ($(this).hasClass('active')) {
			$(this).find('span').html('&#x25B2;')

		} else {
			$(this).find('span').html('&#x25BC;')
		}
	})

	// register the login as an ajax form widget
	register_form('login_form', 'ajax_login', 'login_form', 'submit_login')

	// define a callback to be executed after a successful login
	var login_success_callback = function(data) {
		$("#login_div").html(
			"<nav><ul><li id=\"login-trigger\">Welcome "
			+ document.getElementById('username').value
			+ "</li></ul></nav>"
		);
		window.location = RELOAD_URL;
	}

	// define a callback to be executed when login fails
	var login_error_callback = function(data) {
		alert('could not log in');
	}

	// bind the callbacks to the login widget
	$(document).ready(function(){
		widgets['login_form'].widget.hook('success', login_success_callback);
		widgets['login_form'].widget.hook('error', login_error_callback);
	});

	// make clicking the logout cause a logout and reload the page
	$( "#logout" ).click(function( event ) {
		ajax('ajax_logout', {}, {
			'success': function(){
				window.location = RELOAD_URL;
			},
			'error': function(){alert('error')}
		})
	});

}());




</script>
