{% load staticfiles %}
{% load apptags %}

{% if request|getLoggedInUser != "false" %}}
<div id="login-div">
<nav>
  <ul>
    <li id="login-trigger"> Welcome {{request|getLoggedInUser}}
    </li>
    <li id ="login-trigger"><input type="button" id="logout" value="logout">
   </li>
  </ul>
</nav>
</div>

{% else %}
<div id="login-div">
<nav>
  <ul>
    <li id="login">
      <a id="login-trigger" href="#">
        Log in <span>?</span>
      </a>
      <div id="login-content">
          <fieldset id="inputs">
            <input id="username" type="email" name="Email" placeholder="Your email address" required>   
            <input id="password" type="password" name="Password" placeholder="Password" required>
          </fieldset>
          <fieldset id="actions">
            <input type="button" id="submit" value="Log in">
            <label><input type="checkbox" checked="checked"> Keep me signed in</label>
          </fieldset>
      </div>                     
    </li>
    <li id="signup">
      <a href="{% url "userRegistration" %}">Sign up FREE</a>
    </li>
  </ul>
</nav>
</div>
{% endif %}
<script>

$(document).ready(function(){
  $('#login-trigger').click(function(){
    $(this).next('#login-content').slideToggle();
    $(this).toggleClass('active');          
    
    if ($(this).hasClass('active')) $(this).find('span').html('&#x25B2;')
      else $(this).find('span').html('&#x25BC;')
    })
});

$( "#submit" ).click(function( event ) {
var URL = {% url "handle_ajax_login" %};
  	  $.ajax({
   	   url:URL,
	   type: 'GET',
   	   async: false,
           data: {
               username: document.getElementById('username').value,
           	password: document.getElementById('password').value,
               csrfmiddlewaretoken: '{{ csrf_token }}'
                },  
      	   success:function(data) {
		data=data.replace(/(\r\n|\n|\r)/gm,"");
		if(data=="accepted"){
		$("#login-div").html("<nav><ul><li id=\"login-trigger\">Welcome   "+  document.getElementById('username').value+"</li></ul></nav>");
		 location.reload();
		}
 	}
   });
});

$( "#logout" ).click(function( event ) {
var URL = {% url "handle_ajax_logout" %};
  	  $.ajax({
   	   url:URL,
	   type: 'GET',
   	   async: false,
           data: {
               csrfmiddlewaretoken: '{{ csrf_token }}'
                },  
      	   success:function(data) {
		 location.reload();
		}
 	
   });
});



</script>