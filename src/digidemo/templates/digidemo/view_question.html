{% extends "digidemo/__two_column.html" %}
{% load staticfiles %}
{% load apptags %}
{% block maincol %}

	{% include "digidemo/_i_post.html" with post=question include_id="q" %}

	<div class="clear"></div>

	{% if answers|length > 0 %}
		{% include "digidemo/_i_hr_flourish.html" %}
	{% endif %}

	<div class="clear"></div>

	<div id="answers">
		{% for answer in answers %}
			{% if not forloop.first %}
				<hr>
			{% endif %}

			{% include "digidemo/_i_reply.html" with reply=answer include_id=forloop.counter %}
		{% endfor %}
	</div>

	{% include "digidemo/_i_hr_flourish.html" %}

	<h2>Your Answer</h2>
	{% include "digidemo/_w_ajax_form.html" with form=answer_form %}

	<script type="text/javascript">
		(function(){

			$(document).ready(function() {

				// get the answer form
				var answer_form = widgets[
					'{{answer_form.form_class}}_']['widget'];

				// add a hook so that when the answer form submits 
				// successfully, the new answer is displayed
				answer_form.hook('success', function(data) {

					answers_wrapper = $('#answers');

					// if there's already some answers, put a divider  first
					if(answers_wrapper.children().length) {
						answers_wrapper.append('<hr>');
					} else {

						// its not very dry, but I'm coding the flourish
						// that separates the question from answers here...
						// the alternative, to do another ajax request for it
						// by template seems too complex...
						flourish = $('<div class="hr_flourish"></div>');
						flourish.append('<div class="hr"></div>')
						flourish.append('<div class="flourish"></div>')

						answers_wrapper.append('<div class="clear"></div>')
						answers_wrapper.append(flourish)
					}

					// now insert the new answer
					answers_wrapper.append(data.html);

					// and clear the text from the answer form
					$('#AnswerForm_text').val('');

				});

			});

		}());
	</script>

{% endblock maincol %}
